(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"0273":function(e,t,s){},"0667":function(e,t,s){},"15f8":function(e,t,s){"use strict";var i=s("0273"),n=s.n(i);n.a},"1a7f":function(e,t,s){"use strict";var i=s("52cf"),n=s.n(i);n.a},2096:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACg0lEQVR4AWyTA5A1RxCANy5XzEJs2ynEdim2bdu2bSe/bVvP5o/Tu7eemf5Omzp+651pd1v/A2wcPTfRRi4A3gVGRdd7RuRCYNOBe4cJ274+XRtZDVDT8F8RRhWhGACAMRKzfXNWJLPRUMs30o9+Y74f7v5hU+/1cVN/uVKFgKaf2wZ5ApwOMGplg4arVaXTyJX/uXLur47MrRr5fUmbLC054iuj/l3RQcQ5vcIHPxfbBFj923KXTW5dokat6uTivzy54DdHOnxDqm6zwwMrZIcHV8jhL8axbl6ifl7qAMSf/q+6uQVc4Ans9tgqvdW9y2VBrikfLVWyYq0CYIMLy0sO/y5v59pv8rLtfcvZ5eGVyhUALraibHcvFsIeBeNWdwgR6VyeQqFABLZCusOU234qKh8APrK0kVH0oQ96LiYP/VkGIJnJs/9RJ7DPEceTSKUJgMv/tHliRiCAAjAiYywj/Qqu/jonR74UwzOQzefZ58jj2bf7WhVPAfD2fI8Lf3cEpF8B8B7AK3P9cHIukHq7L2I0AJlMmjWJFH0IC6pajv/Wlqdm+Io+PraACxVw2k+OPuUHR56dFcissibbpmlE25YUbZ78t0K6zcjRX9uc8bOjot66xHp0mrcpEJtYhgM/a6pL/nQ4+Xu711KxYWi3Aw55IS57P7FKpuUCDvzcVmMKACR/Wh1uETUSZwFMKWh8JSq2QTM+G8qkWEMOfHaNHPtKQmI1FzsUNTmviDhvaCvfRj/qpTFVZV2zSFnXLVJ3/VJSgKKfOwfI9g+Gp+QcbSQOsKYFvl7s8+0Sn2QbRFlPekrOGygz0jhvrrRcDHwEjImuj42RS4DemEWka/DsDABaxANkajsJKgAAAABJRU5ErkJggg=="},"50e6":function(e,t,s){"use strict";var i=s("0667"),n=s.n(i);n.a},"52cf":function(e,t,s){},"9b19":function(e,t,s){e.exports=s.p+"img/logo.3cc86b5c.svg"},a5c4:function(e,t,s){"use strict";var i=s("bce2"),n=s.n(i);n.a},bce2:function(e,t,s){},cc15:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-layout",{attrs:{view:"hHh lpR fFf"}},[s("main-header"),s("q-drawer",{attrs:{"show-if-above":"",mini:!e.drawerForceOpen&&e.miniState,side:"right",elevated:"","mini-to-overlay":!e.drawerForceOpen,breakpoint:0,width:250},on:{mouseover:function(t){e.miniState=!1},mouseout:function(t){e.miniState=!0}}},[s("div",{attrs:{align:"right"}},[s("q-btn",{staticClass:"pin q-ma-sm",class:{pinned:e.drawerForceOpen},attrs:{flat:"",round:"",size:"sm",icon:"fas fa-thumbtack"},on:{click:function(t){e.drawerForceOpen=!e.drawerForceOpen}}})],1),s("q-list",{staticStyle:{},attrs:{padding:""}},[s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.refreshRequests(t)}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"fas fa-sync-alt"}})],1),s("q-item-section",{staticClass:"text-h6"},[e._v("\n          Обновить\n        ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],staticClass:"text-negative",attrs:{clickable:""},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.newRequest(t)}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"fas fa-bell"}})],1),s("q-item-section",{staticClass:"text-h6"},[e._v("\n          Новая заявка\n        ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.showFilterSetup=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"fas fa-filter",color:e.filterIconColor}})],1),s("q-item-section",{staticClass:"text-h6"},[e._v("\n          Фильтр\n        ")])],1),s("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){t.preventDefault(),t.stopPropagation(),e.showMessageSettings=!0}}},[s("q-item-section",{attrs:{avatar:""}},[s("q-icon",{attrs:{name:"fas fa-sms"}})],1),s("q-item-section",{staticClass:"text-h6"},[e._v("\n          Настройка сообщений\n        ")])],1)],1)],1),s("q-page-container",[s("q-page",[s("q-splitter",{staticStyle:{"min-height":"calc( 100vh - 106px)"},attrs:{unit:"px",limits:[130,130]},scopedSlots:e._u([{key:"before",fn:function(){return[s("q-tabs",{staticClass:"text-primary",attrs:{vertical:"","active-bg-color":"primary","active-color":"white","indicator-color":"primary"},on:{input:e.onChangeTab},model:{value:e.selectedTab,callback:function(t){e.selectedTab=t},expression:"selectedTab"}},e._l(e.tabs,(function(t,i){return s("q-tab",{key:i,attrs:{"no-caps":"",name:i,icon:t.icon,label:t.label}},[s("q-badge",{attrs:{floating:"",transparent:"",color:t.badgeColor}},[e._v("\n                "+e._s(t.show)+" / "+e._s(t.total)+"\n              ")])],1)})),1)]},proxy:!0},{key:"after",fn:function(){return["planned"===e.selectedTab?s("q-table",{staticClass:"mainTable",attrs:{"row-key":"number",flat:"",dense:"","hide-bottom":"","virtual-scroll":"",separator:"cell",data:e.requests,columns:e.plannedTable,pagination:e.pagination,"rows-per-page-options":[0],"virtual-scroll-sticky-size-start":28},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body-cell-icons",fn:function(t){return[s("q-td",{attrs:{props:t,"data-number":t.row.number}},[s("q-icon",{attrs:{name:t.row.state.canGet?e.states.planned.icon:"far fa-calendar-times",color:t.row.state.canGet?e.states.planned.color:"warning",size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(e.states.planned.tooltip)+"\n                  ")])],1),null!==t.row.partner.id?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:e.states.partner.icon,color:e.states.partner.color,size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(t.row.partner.name)+"\n                  ")])],1):e._e()],1)]}},{key:"body-cell-service",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.service.text)+"\n                "),s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.service.tooltip)+"\n                ")])],1)]}}],null,!1,894678947)}):s("q-table",{staticClass:"mainTable",attrs:{"row-key":"number",flat:"",dense:"","hide-bottom":"","virtual-scroll":"",separator:"cell",selection:"none",data:e.requests,columns:e.mainTable,selected:[void 0===e.activeRequest?{number:0}:e.activeRequest],pagination:e.pagination,"rows-per-page-options":[0],"virtual-scroll-sticky-size-start":28,"virtual-scroll-item-size":37},on:{"update:pagination":function(t){e.pagination=t},"row-dblclick":function(t){return t.preventDefault(),e.onRequestDblClick(t)}},scopedSlots:e._u([{key:"body-cell-icons",fn:function(t){return[s("q-td",{attrs:{props:t,"data-number":t.row.number}},[s("q-icon",{attrs:{name:e.states[t.row.state.current].icon,color:e.states[t.row.state.current].color,size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(e.states[t.row.state.current].tooltip)+"\n                  ")])],1),null===t.row.state.sync1C?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:e.states.sync1C.icon,color:e.states.sync1C.color,size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(e.states.sync1C.tooltip)+"\n                  ")])],1):e._e(),null!==t.row.partner.id?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:e.states.partner.icon,color:e.states.partner.color,size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(t.row.partner.name)+"\n                  ")])],1):e._e(),t.row.state.wait?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:e.states.wait.icon,color:e.states.wait.color,size:"1em"}},[s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                    "+e._s(e.states.wait.tooltip)+"\n                    "),t.row.waitTo?s("span",[e._v(e._s(" до "+t.row.waitTo))]):e._e()])],1):e._e()],1)]}},{key:"body-cell-number",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.number)+"\n                "),null!==t.row.state.sync1C?s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.state.sync1C)+"\n                ")]):e._e()],1)]}},{key:"body-cell-service",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.service.text)+"\n                "),s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.service.tooltip)+"\n                ")])],1)]}},{key:"body-cell-contragent",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.contragent.text)+"\n                "),s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.contragent.tooltip)+"\n                ")])],1)]}},{key:"body-cell-division",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.division.text)+"\n                "),s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.division.tooltip)+"\n                ")])],1)]}},{key:"body-cell-engineer",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n                "+e._s(t.row.engineer.text)+"\n                "),t.row.engineer.tooltip?s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.engineer.tooltip)+"\n                ")]):e._e()],1)]}},{key:"body-cell-time",fn:function(t){return[s("q-td",{attrs:{props:t}},[s("div",{staticClass:"q-pa-xs"},[s("q-linear-progress",{style:"color: "+t.row.time.reactColor,attrs:{value:t.row.time.reactRate,indeterminate:null===t.row.time.reactRate}}),s("q-linear-progress",{staticClass:"q-mt-xs",style:"color: "+t.row.time.fixColor,attrs:{value:t.row.time.fixRate,indeterminate:null===t.row.time.fixRate}}),s("q-linear-progress",{staticClass:"q-mt-xs",style:"color: "+t.row.time.repairColor,attrs:{value:t.row.time.repairRate,indeterminate:null===t.row.time.repairRate}})],1),t.row.time.tooltip?s("q-tooltip",{attrs:{"content-style":"font-size: 0.9em; white-space: pre-line;",delay:1e3}},[e._v("\n                  "+e._s(t.row.time.tooltip)+"\n                ")]):e._e()],1)]}}])}),s("q-menu",{ref:"menu",attrs:{target:".mainTable .q-virtual-scroll__content","touch-position":"","context-menu":"","auto-close":""},on:{"before-show":e.showContextMenu,hide:e.hideContextMenu}},[s("q-list",{attrs:{dense:""}},[s("q-item",{directives:[{name:"show",rawName:"v-show",value:!e.syncedState,expression:"!syncedState"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:""}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.sync1C.icon,color:e.states.sync1C.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Не синхронизировано с 1С\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:"planned"!==e.selectedTab,expression:"selectedTab !== 'planned'"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:""},on:{click:e.doOpen}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fas fa-envelope-open-text",color:"info",size:"1em"}})],1),s("q-item-section",[e._v("\n                  Открыть заявку\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canAccept,expression:"canAccept"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doAccept}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.accepted.icon,color:e.states.accepted.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Принять заявку\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canFix,expression:"canFix"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doFix}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.fixed.icon,color:e.states.fixed.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Работоспособность восстановлена\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canRepair,expression:"canRepair"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doRepair}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.repaired.icon,color:e.states.repaired.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Работы завершены\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canClose,expression:"canClose"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doClose}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.closed.icon,color:e.states.closed.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Подтвердить закрытие\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canDeny,expression:"canDeny"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doDeny}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fas fa-undo",color:"negative",size:"1em"}})],1),s("q-item-section",[e._v("\n                  Отменить закрытие\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canUnCancel,expression:"canUnCancel"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doUnCancel}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fas fa-undo",color:"negative",size:"1em"}})],1),s("q-item-section",[e._v("\n                  Открыть повторно\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canReopen,expression:"canReopen"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doReopen}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:"fas fa-undo",color:"negative",size:"1em"}})],1),s("q-item-section",[e._v("\n                  Открыть повторно\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canCancel,expression:"canCancel"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doCancel}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.canceled.icon,color:e.states.canceled.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Отменить заявку\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canChangePartner,expression:"canChangePartner"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState||e.waitState},on:{click:e.doChangePartner}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.partner.icon,color:e.states.partner.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Назначить партнёра\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canWaitOn,expression:"canWaitOn"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState},on:{click:e.doWaitOn}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.wait.icon,color:e.states.wait.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Приостановить выполнение\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:e.canWaitOff,expression:"canWaitOff"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState},on:{click:e.doWaitOff}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.wait.icon,color:e.states.wait.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Возобновить выполнение\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:"planned"!=e.selectedTab,expression:"selectedTab != 'planned'"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disable:!e.syncedState},on:{click:e.doAddComment}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.comment.icon,color:e.states.comment.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Добавить комментарий\n                ")])],1),s("q-item",{directives:[{name:"show",rawName:"v-show",value:"planned"===e.selectedTab,expression:"selectedTab === 'planned'"},{name:"ripple",rawName:"v-ripple"}],attrs:{dense:"",clickable:"",disabled:!e.canDoNow},on:{click:e.doDoNow}},[s("q-item-section",{attrs:{side:""}},[s("q-icon",{attrs:{name:e.states.received.icon,color:e.states.received.color,size:"1em"}})],1),s("q-item-section",[e._v("\n                  Взять сейчас\n                ")])],1)],1)],1)]},proxy:!0}]),model:{value:e.splitter,callback:function(t){e.splitter=t},expression:"splitter"}})],1)],1),s("main-footer"),s("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:e.showFilterSetup,callback:function(t){e.showFilterSetup=t},expression:"showFilterSetup"}},[s("filter-dialog",{attrs:{filter:e.filter},on:{ok:e.setFilter}})],1),s("q-dialog",{attrs:{"no-backdrop-dismiss":""},model:{value:e.showMessageSettings,callback:function(t){e.showMessageSettings=t},expression:"showMessageSettings"}},[s("message-settings-dialog",{on:{ok:function(t){e.showMessageSettings=!1}}})],1),s("q-dialog",{attrs:{"no-backdrop-dismiss":""},on:{hide:function(t){e.activeRequest={number:0}}},model:{value:e.showRequest,callback:function(t){e.showRequest=t},expression:"showRequest"}},[s("request",{attrs:{number:e.activeRequest.number},on:{close:e.onUpdateRequest,cancel:function(t){e.showRequest=!1}}})],1)],1)},n=[],a=(s("fb6a"),s("4e82"),s("e6cf"),s("498a"),s("ddb0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-header",{staticClass:"bg-primary text-white",attrs:{elevated:""}},[i("q-toolbar",[i("q-space"),i("q-space"),i("img",{staticClass:"main-logo vertical-middle q-pa-sm",attrs:{src:s("9b19")}}),i("q-space"),i("q-toolbar-title",{staticStyle:{"text-align":"right"}},[i("q-btn",{attrs:{flat:"","no-caps":""},on:{click:e.doLoginLogout}},[i("span",{staticClass:"text-h6"},[e._v(e._s(e.userName))]),i("q-icon",{attrs:{right:"",name:e.isAuthorized?"fas fa-sign-out-alt":"fas fa-sign-in-alt"}})],1)],1)],1)],1)}),l=[],o={props:{hasDrawerButton:Boolean},data(){return{pageText:"Портал",pageIcon:"fas fa-home",routes:[]}},computed:{userName(){return this.$store.state.auth&&this.$store.state.auth.isAuthorized?this.$store.getters["auth/payload"].name:"ВОЙТИ"},isAuthorized(){return this.$store.state.auth&&this.$store.state.auth.isAuthorized}},methods:{doLoginLogout(){this.isAuthorized&&(this.$store.dispatch("auth/setToken",null),this.$store.dispatch("auth/setRefreshToken",null),this.$store.dispatch("auth/unsetAuthorized")),this.$jsonRPC("Auth::checkAuth",{})}}},r=o,c=(s("1a7f"),s("2877")),d=s("e359"),u=s("65c6"),p=s("2c91"),h=s("6ac5"),m=s("9c40"),v=s("0016"),f=s("eebe"),b=s.n(f),q=Object(c["a"])(r,a,l,!1,null,"be72856a",null),g=q.exports;b()(q,"components",{QHeader:d["a"],QToolbar:u["a"],QSpace:p["a"],QToolbarTitle:h["a"],QBtn:m["a"],QIcon:v["a"]});var w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-footer",{staticClass:"bg-primary text-white",attrs:{elevated:""}},[i("q-toolbar",{staticClass:"text-h6"},[i("q-toolbar-title",[i("q-icon",{attrs:{name:"fas fa-phone-alt"}}),e._v("\n      8 (8212) 400-440\n    ")],1),i("q-toolbar-title",{staticStyle:{"text-align":"center"}},[i("q-btn",{attrs:{flat:"","no-caps":"",type:"a",href:"https://www.sodrk.ru/rms",download:""}},[i("q-icon",{attrs:{left:"",name:"fas fa-desktop"}}),i("span",{staticClass:"text-h6"},[e._v("\n          Удалённый помощник\n        ")])],1)],1),i("q-toolbar-title",{staticStyle:{"font-size":"0.8rem","text-align":"right","line-height":"1.6em"}},[i("q-icon",{attrs:{name:"far fa-copyright"}}),i("span",[e._v(" by RSA, 2020")]),i("br"),i("a",{staticClass:"text-white",attrs:{href:"https://quasar.dev",target:"_blank"}},[i("img",{staticClass:"vertical-middle",attrs:{src:s("2096")}}),i("span",[e._v(" Quasar")])])],1)],1)],1)},y=[],C={data(){return{}},methods:{loadRMS(){this.$jsonRPC("Test::check",{})}}},x=C,k=s("7ff0"),D=Object(c["a"])(x,w,y,!1,null,null,null),L=D.exports;b()(D,"components",{QFooter:k["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QIcon:v["a"],QBtn:m["a"]});var S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-card",{staticClass:"q-dialog-plugin"},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h6 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n        Фильтр заявок\n      ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",[s("q-card-section",[e.divisionsList.length>4?s("q-select",{attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:""===e.selectedDivision.prefix?"Клиент":e.selectedDivision.prefix,behaviuor:"menu",options:e.divisionsFiltered},on:{filter:e.filterDivisions,input:e.limitDivisionTypesList},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n              Нет совпадений\n            ")])],1)]},proxy:!0},{key:"option",fn:function(t){return[s("q-item",e._g(e._b({},"q-item",t.itemProps,!1),t.itemEvents),[s("q-item-section",[s("q-item-label",[s("span",{class:"option-"+t.opt.type},[e._v("\n                  "+e._s(t.opt.label)+"\n                ")])])],1)],1)]}}],null,!1,1549639765),model:{value:e.selectedDivision,callback:function(t){e.selectedDivision=t},expression:"selectedDivision"}}):e._e(),e.divisionTypesLimited.length>2?s("q-select",{attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:"Тип подразделения",behaviuor:"menu",options:e.divisionTypesFiltered},on:{filter:e.filterDivisionTypes},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n              Нет совпадений\n            ")])],1)]},proxy:!0}],null,!1,2581410081),model:{value:e.selectedDivisionType,callback:function(t){e.selectedDivisionType=t},expression:"selectedDivisionType"}}):e._e(),e.partnersList.length>2?s("q-select",{attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:"Партнёр",behaviuor:"menu",options:e.partnersFiltered},on:{filter:e.filterPartners},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n              Нет совпадений\n            ")])],1)]},proxy:!0}],null,!1,2581410081),model:{value:e.selectedPartner,callback:function(t){e.selectedPartner=t},expression:"selectedPartner"}}):e._e(),e.servicesList.length>2?s("q-select",{attrs:{dense:"","options-dense":"",multiple:"","emit-value":"","input-debounce":"0",label:"Услуга",behaviuor:"menu",options:e.servicesList,"display-value":e.selectedServicesDisplay},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n              Нет совпадений\n            ")])],1)]},proxy:!0},{key:"option",fn:function(t){return[s("q-item",e._g(e._b({},"q-item",t.itemProps,!1),t.itemEvents),[s("q-item-section",{attrs:{side:""}},[null===t.opt.value?s("q-toggle",{attrs:{dense:"","indeterminate-value":"null"},on:{input:e.toggleServicesAll},model:{value:e.selectedServicesAll,callback:function(t){e.selectedServicesAll=t},expression:"selectedServicesAll"}}):s("q-toggle",{attrs:{dense:"",val:t.opt.value},on:{input:e.toggleService},model:{value:e.selectedServices,callback:function(t){e.selectedServices=t},expression:"selectedServices"}})],1),s("q-item-section",[s("q-item-label",[e._v("\n                "+e._s(t.opt.name)+" "+e._s(t.opt.shortName?"( "+t.opt.shortName+" )":"")+"\n              ")])],1)],1)]}}],null,!1,1213766975),model:{value:e.selectedServices,callback:function(t){e.selectedServices=t},expression:"selectedServices"}}):e._e(),s("q-input",{attrs:{dense:"",clearable:"",label:"Текст"},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),s("div",{staticClass:"q-pt-xs"},[e._v("\n        Дата поступления (для закрытых и отменённых):\n      ")]),s("q-option-group",{attrs:{dense:"",size:"xs",options:e.intervalOptions},on:{input:e.intervalChanged},model:{value:e.interval,callback:function(t){e.interval=t},expression:"interval"}}),null===e.interval?s("div",{staticClass:"row"},[s("q-input",{staticClass:"col q-pr-sm",attrs:{dense:"",readonly:"",label:"С даты"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"fas fa-calendar-alt"}},[s("q-popup-proxy",{ref:"qFromDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-date",{attrs:{mask:"YYYY-MM-DD",minimal:""},on:{input:e.inputFromDate},model:{value:e.fromDate,callback:function(t){e.fromDate=t},expression:"fromDate"}})],1)],1),e.fromDate?s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"fas fa-times-circle"},on:{click:function(t){t.stopPropagation(),e.fromDate=null}}}):e._e()]},proxy:!0}],null,!1,3880253007),model:{value:e.fromDateHuman,callback:function(t){e.fromDateHuman=t},expression:"fromDateHuman"}}),s("q-input",{staticClass:"col q-pl-sm",attrs:{dense:"",readonly:"",label:"До даты"},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"fas fa-calendar-alt"}},[s("q-popup-proxy",{ref:"qToDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-date",{attrs:{mask:"YYYY-MM-DD",minimal:""},on:{input:e.inputToDate},model:{value:e.toDate,callback:function(t){e.toDate=t},expression:"toDate"}})],1)],1),e.toDate?s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"fas fa-times-circle"},on:{click:function(t){t.stopPropagation(),e.toDate=null}}}):e._e()]},proxy:!0}],null,!1,3386666242),model:{value:e.toDateHuman,callback:function(t){e.toDateHuman=t},expression:"toDateHuman"}})],1):e._e()],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{attrs:{color:"info",label:"Сохранить",icon:"fas fa-save",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onSaveFilterClick(t)}}}),s("q-btn",{attrs:{color:"warning",label:"Сбросить",icon:"fas fa-recycle",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onResetClick(t)}}}),s("q-btn",{attrs:{type:"submit",color:"primary",label:"Применить",icon:"fas fa-check",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onOkClick(t)}}})],1)],1)],1)},R=[],_=(s("c975"),s("bd4c"));const P=[{label:"1 последний год",value:"1y"},{label:"3 последних месяца",value:"3m"},{label:"1 последний месяц",value:"1m"},{label:"1 последняя неделя",value:"1w"},{label:"указать интервал",value:null}];var A={name:"FilterDialog",props:{filter:{type:Object,default:()=>{}}},data(){return{selectedDivision:{},selectedDivisionType:{},selectedPartner:{},selectedServices:[],selectedServicesAll:null,text:"",interval:"3m",fromDate:null,toDate:null,divisionsFiltered:[],divisionsList:[],divisionTypesFiltered:[],divisionTypesList:[],divisionTypesLimited:[],partnersList:[],partnersFiltered:[],servicesList:[],servicesFiltered:[],intervalOptions:P}},computed:{fromDateHuman(){return null===this.fromDate?"":this.formatDate(this.fromDate)},toDateHuman(){return null===this.toDate?"":this.formatDate(this.toDate)},selectedServicesDisplay(){if(null!==this.selectedServicesAll)return"Все";if(1===this.selectedServices.length)return this.servicesList.find((e=>null!==e.value&&this.selectedServices.includes(e.value))).name;if(this.selectedServices.length<=5)return this.servicesList.filter((e=>this.selectedServices.includes(e.value))).map((e=>e.shortName)).join(", ");if(this.selectedServices.length===this.servicesList.length-2){const e=this.servicesList.find((e=>null!==e.value&&!this.selectedServices.includes(e.value))).name;return"КРОМЕ "+e}if(this.selectedServices.length>=this.servicesList.length-6){const e=this.servicesList.filter((e=>null!==e.value&&!this.selectedServices.includes(e.value))).map((e=>e.shortName)).join(", ");return"КРОМЕ "+e}return`Выбраны ${this.selectedServices.length} из ${this.servicesList.length-1}`}},mounted(){this.fillFilter(this.filter)},methods:{fillFilter(e){this.fillFilterLists(e),this.text=e.text,this.interval=e.interval,this.fromDate=e.fromDate,this.toDate=e.toDate},buildFilter(){return{contragent:"contragent"===this.selectedDivision.type?this.selectedDivision.value:null,contract:"contract"===this.selectedDivision.type?this.selectedDivision.value:null,division:"division"===this.selectedDivision.type?this.selectedDivision.value:null,divisionType:this.selectedDivisionType.value,excludedServices:this.selectedServices.length===this.servicesList.length-1?[]:this.servicesList.map((e=>e.value)).filter((e=>null!==e&&!this.selectedServices.includes(e))),partner:this.selectedPartner.value,text:this.text,interval:this.interval,fromDate:this.fromDate,toDate:this.toDate}},onOkClick(){this.$emit("ok",this.buildFilter())},onResetClick(){const e=localStorage.getItem("filter");null===e?([this.selectedDivision]=this.divisionsList,[this.selectedDivisionType]=this.divisionTypesList,[this.selectedPartner]=this.partnersList,this.selectedServices=this.servicesList.map((e=>e.value)),this.selectedServices.shift(),this.selectedServicesAll=!0,this.text="",this.interval=this.filter.interval,this.fromDate=null,this.toDate=null):this.fillFilter(JSON.parse(e))},onSaveFilterClick(){localStorage.setItem("filter",JSON.stringify(this.buildFilter()))},inputFromDate(){this.toDate<this.fromDate&&(this.toDate=this.fromDate),this.$refs.qFromDateProxy.hide()},inputToDate(){this.fromDate>this.toDate&&(this.fromDate=this.toDate),this.$refs.qToDateProxy.hide()},formatDate(e){return _["b"].formatDate(_["b"].extractDate(e,"YYYY-MM-DD"),"D MMMM YYYY",{months:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]})},sortByName(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())},async fillDivisionsList(e){const t=await this.$jsonRPC("Division::getList",{});this.divisionsList=[{type:"contragent",value:null,label:"Все",prefix:"",divisionTypes:null}],t.contragents.sort(this.sortByName);for(let i=0;i<t.contragents.length;i+=1){this.divisionsList.push({type:"contragent",value:t.contragents[i].id,label:t.contragents[i].name,prefix:"",divisionTypes:t.contragents[i].divTypeIds}),t.contragents[i].contracts.sort(this.sortByName);for(let e=0;e<t.contragents[i].contracts.length;e+=1){this.divisionsList.push({type:"contract",value:t.contragents[i].contracts[e].id,label:"Договор "+t.contragents[i].contracts[e].name,prefix:t.contragents[i].name,divisionTypes:t.contragents[i].contracts[e].divTypeIds}),t.contragents[i].contracts[e].divisions.sort(this.sortByName);for(let s=0;s<t.contragents[i].contracts[e].divisions.length;s+=1)this.divisionsList.push({type:"division",value:t.contragents[i].contracts[e].divisions[s].id,label:t.contragents[i].contracts[e].divisions[s].name,prefix:`${t.contragents[i].name} / Договор ${t.contragents[i].contracts[e].name}`,divisionTypes:t.contragents[i].contracts[e].divisions[s].divTypeIds})}}const s=e.contragent||e.contract||e.division;this.selectedDivision=this.divisionsList.find((e=>e.value===s)),void 0===this.selectedDivision&&([this.selectedDivision]=this.divisionsList),this.divisionTypesList=t.divisionTypes.sort(this.sortByName).map((e=>({label:e.name,value:e.id}))),this.divisionTypesList.unshift({value:null,label:"Все"}),this.selectedDivisionType=this.divisionTypesList.find((t=>t.value===e.divisionType)),void 0===this.selectedDivisionType&&([this.selectedDivisionType]=this.divisionTypesList),this.limitDivisionTypesList()},async fillPartnersList(e){const t=await this.$jsonRPC("Partner::getList",{});this.partnersList=t.partners.sort(this.sortByName).map((e=>({label:e.name,value:e.id}))),this.partnersList.unshift({value:null,label:"Все"}),this.selectedPartner=this.partnersList.find((t=>t.value===e.partner)),void 0===this.selectedPartner&&([this.selectedPartner]=this.partnersList)},async fillServicesList(e){const t=await this.$jsonRPC("Service::getList",{});this.servicesList=t.services.sort(this.sortByName).map((e=>({name:e.name,value:e.id,shortName:e.shortName}))),this.selectedServicesAll=null,0===e.excludedServices.length?(this.selectedServices=this.servicesList.map((e=>e.value)),this.selectedServicesAll=!0):(this.selectedServices=this.servicesList.filter((t=>!e.excludedServices.includes(t.value))).map((e=>e.value)),this.selectedServices.length===this.servicesList.length&&(this.selectedServicesAll=!0)),this.servicesList.unshift({value:null,name:"Все",shortName:!1})},async fillFilterLists(e){await Promise.all([this.fillDivisionsList(e),this.fillPartnersList(e),this.fillServicesList(e)])},filterDivisions(e,t){""===e&&t((()=>{this.divisionsFiltered=this.divisionsList}));const s=e.toLowerCase();t((()=>{let e=null,t=null,i=!1,n=!1;this.divisionsFiltered=[];for(let a=0;a<this.divisionsList.length;a+=1)switch(this.divisionsList[a].type){case"contragent":e=this.divisionsList[a],i=!1,this.divisionsList[a].label.toLowerCase().indexOf(s)>-1&&(i=!0,this.divisionsFiltered.push(this.divisionsList[a]));break;case"contract":if(t=this.divisionsList[a],n=!1,i){this.divisionsFiltered.push(this.divisionsList[a]);break}this.divisionsList[a].label.toLowerCase().indexOf(s)>-1&&(null!==e&&(this.divisionsFiltered.push(e),e=null),this.divisionsFiltered.push(this.divisionsList[a]),n=!0);break;case"division":default:if(i||n){this.divisionsFiltered.push(this.divisionsList[a]);break}this.divisionsList[a].label.toLowerCase().indexOf(s)>-1&&(null!==e&&(this.divisionsFiltered.push(e),e=null),null!==t&&(this.divisionsFiltered.push(t),t=null),this.divisionsFiltered.push(this.divisionsList[a]))}}))},limitDivisionTypesList(){const e=this.selectedDivision.divisionTypes;this.divisionTypesLimited=null===e?this.divisionTypesList:this.divisionTypesList.filter((t=>e.includes(t.value)||null===t.value)),this.divisionTypesLimited.includes(this.selectedDivisionType)||([this.selectedDivisionType]=this.divisionTypesLimited)},filterDivisionTypes(e,t){""===e&&t((()=>{this.divisionTypesFiltered=this.divisionTypesLimited}));const s=e.toLowerCase();t((()=>{this.divisionTypesFiltered=this.divisionTypesLimited.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},filterPartners(e,t){""===e&&t((()=>{this.partnersFiltered=this.partnersList}));const s=e.toLowerCase();t((()=>{this.partnersFiltered=this.partnersList.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},toggleServicesAll(e){this.selectedServices=e?this.servicesList.map((e=>e.value)).slice(1):[]},toggleService(e){0===e.length?this.selectedServicesAll=!1:e.length===this.servicesList.length-1?this.selectedServicesAll=!0:this.selectedServicesAll=null},intervalChanged(e){null!==e&&(this.fromDate=null,this.toDate=null)}}},$=A,T=(s("50e6"),s("f09f")),Q=s("24e8"),N=s("a370"),F=s("0378"),z=s("ddd8"),O=s("66e5"),E=s("4074"),M=s("0170"),j=s("9564"),I=s("27f9"),B=s("9f0a"),W=s("7cbe"),Y=s("52ee"),H=s("4b7e"),U=s("7f67"),V=Object(c["a"])($,S,R,!1,null,"55f0d5bc",null),J=V.exports;b()(V,"components",{QCard:T["a"],QDialog:Q["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QSelect:z["a"],QItem:O["a"],QItemSection:E["a"],QItemLabel:M["a"],QToggle:j["a"],QInput:I["a"],QOptionGroup:B["a"],QIcon:v["a"],QPopupProxy:W["a"],QDate:Y["a"],QCardActions:H["a"]}),b()(V,"directives",{ClosePopup:U["a"]});var K=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-card",{staticClass:"q-dialog-plugin",staticStyle:{"max-width":"1000px",width:"80vw"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h6 q-pa-sm"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n        Настройки сообщений\n      ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",[s("q-card-section",[s("div",{staticClass:"row q-gutter-md q-pb-md"},[s("q-input",{staticClass:"col",attrs:{dense:"",label:"Роль",readonly:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:"fa fa-user-tag"}})]},proxy:!0}]),model:{value:e.role,callback:function(t){e.role=t},expression:"role"}}),s("q-input",{staticClass:"col",attrs:{dense:"",label:"Адрес электронной почты",readonly:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:"fa fa-envelope"}})]},proxy:!0}]),model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),s("q-input",{staticClass:"col",attrs:{dense:"",label:"Номер для SMS",prefix:"+7",mask:"(###) ###-##-##","unmasked-value":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:"fas fa-sms"}})]},proxy:!0}]),model:{value:e.cellphone,callback:function(t){e.cellphone=t},expression:"cellphone"}})],1),1==e.contracts.length?s("q-table",{staticClass:"events-table",attrs:{"row-key":"id",dense:"","hide-bottom":"",data:e.events,columns:e.columns0,pagination:e.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([e.methods.includes("email")?{key:"body-cell-email",fn:function(t){return[s("q-td",{attrs:{props:t}},[s("q-toggle",{attrs:{dense:"","keep-color":"",color:"primary",disable:e.settings[e.allContracts][t.row.id].email.forced},model:{value:e.settings[e.allContracts][t.row.id].email.send,callback:function(s){e.$set(e.settings[e.allContracts][t.row.id].email,"send",s)},expression:"settings[allContracts][props.row.id].email.send"}})],1)]}}:null,e.methods.includes("sms")?{key:"body-cell-sms",fn:function(t){return[s("q-td",{attrs:{props:t}},[s("q-toggle",{attrs:{dense:"","keep-color":"",color:"primary",value:e.settings[e.allContracts][t.row.id].sms.send,disable:e.settings[e.allContracts][t.row.id].sms.forced}})],1)]}}:null,e.methods.includes("teams")?{key:"body-cell-teams",fn:function(t){return[s("q-td",{attrs:{props:t}},[s("q-toggle",{attrs:{dense:"","keep-color":"",color:"primary",value:e.settings[e.allContracts][t.row.id].teams.send,disable:e.settings[e.allContracts][t.row.id].teams.forced}})],1)]}}:null],null,!0)}):s("q-table",{staticClass:"events-table contracts-events-table",attrs:{"row-key":"id",dense:"","hide-bottom":"",data:e.contracts,columns:e.columns,pagination:e.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"header",fn:function(t){return[s("q-tr",{attrs:{props:t}},e._l(t.cols,(function(i){return s("q-th",{key:i.name,attrs:{props:t}},[s("div",{staticClass:"header"},[e._v("\n                "+e._s(i.label)+"\n              ")]),"contract"!==i.name?s("div",{staticClass:"toggles q-mx-xs"},e._l(e.methods,(function(t){return s("q-toggle",{key:t,attrs:{dense:"","keep-color":"",color:"primary",size:"sm",disable:e.settings[e.allContracts][i.name][t].forced,icon:e.methodsDesc[t].icon},on:{input:function(s){return e.toggle(e.allContracts,i.name,t)}},model:{value:e.settings[e.allContracts][i.name][t].send,callback:function(s){e.$set(e.settings[e.allContracts][i.name][t],"send",s)},expression:"settings[allContracts][col.name][method].send"}},[s("q-tooltip",[e._v("\n                    "+e._s(e.methodsDesc[t].label)+"\n                  ")])],1)})),1):e._e()])})),1)]}},{key:"body",fn:function(t){return[t.row.id!==e.allContracts?s("q-tr",{attrs:{props:t}},[s("q-td",{key:"contract",attrs:{props:t}},[s("div",[e._v("\n                "+e._s(t.row.name)+"\n              ")])]),e._l(e.events,(function(i){return s("q-td",{key:i.id},[s("div",e._l(e.methods,(function(n){return s("q-toggle",{key:n,staticClass:"q-px-xs",attrs:{dense:"","keep-color":"",color:"primary",size:"sm",disable:e.settings[e.allContracts][i.id][n].forced,icon:e.methodsDesc[n].icon},on:{input:function(s){return e.toggle(t.row.id,i.id,n)}},model:{value:e.settings[t.row.id][i.id][n].send,callback:function(s){e.$set(e.settings[t.row.id][i.id][n],"send",s)},expression:"settings[props.row.id][event.id][method].send"}})})),1)])}))],2):e._e()]}}])})],1),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{attrs:{color:"primary",label:"Применить",icon:"fas fa-check",size:"sm"},on:{click:e.apply}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"negative",label:"Отменть",icon:"fas fa-times",size:"sm"}})],1)],1)],1)},G=[];const X={email:{label:"E-Mail",icon:"fas fa-envelope"},sms:{label:"SMS",icon:"fas fa-sms"},teams:{label:"Teams",icon:"fas fa-user-friends"}},Z="00000000000000000000000000000000";var ee={name:"MessageSettingsDialog",data(){return{role:"",cellphone:"",email:"",events:[],rows:[],methods:[],contracts:[],settings:{},columns0:[],columns:[],pagination:{rowsPerPage:0},methodsDesc:X,allContracts:Z}},async mounted(){const e=await this.$jsonRPC("User::getMessageSettings",{});this.role=e.role,this.email=e.email,this.cellphone=e.cellphone,this.contracts=e.contracts.sort(((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase()))),this.events=e.events,this.methods=e.methods,this.columns0=[{name:"event",label:"Событие",field:"name",required:!0,align:"left"}];for(let t=0;t<this.methods.length;t+=1)this.columns0.push({name:this.methods[t],label:X[this.methods[t]].label,required:!0,align:"center"});this.columns=[{name:"contract",label:"Договор",field:"name",required:!0,align:"left"}];for(let t=0;t<this.events.length;t+=1)this.columns.push({name:this.events[t].id,label:this.events[t].name,required:!0,align:"center"});e.contracts.unshift({id:Z,name:" Все "}),this.settings={};for(let t=0;t<e.contracts.length;t+=1){this.$set(this.settings,e.contracts[t].id,{});for(let s=0;s<e.events.length;s+=1){this.$set(this.settings[e.contracts[t].id],e.events[s].id,{});for(let i=0;i<e.methods.length;i+=1)this.$set(this.settings[e.contracts[t].id][e.events[s].id],e.methods[i],{}),this.$set(this.settings[e.contracts[t].id][e.events[s].id][e.methods[i]],"forced",e.settings[Z][e.events[s].id][e.methods[i]].forced),this.$set(this.settings[e.contracts[t].id][e.events[s].id][e.methods[i]],"send",e.settings[Z][e.events[s].id][e.methods[i]].send||e.settings[Z][e.events[s].id][e.methods[i]].forced);if(void 0!==e.settings[e.contracts[t].id]&&void 0!==e.settings[e.contracts[t].id][e.events[s].id]){const i=Object.keys(this.settings[e.contracts[t].id][e.events[s].id]);for(let n=0;n<i.length;n+=1)this.settings[e.contracts[t].id][e.events[s].id][i[n]].send=e.settings[e.contracts[t].id][e.events[s].id][i[n]].send||e.settings[Z][e.events[s].id][e.methods[n]].forced}}}},methods:{toggle(e,t,s){if(this.settings[e][t][s].forced)return;const i=this.settings[e][t][s].send;if(e===Z){for(let e=0;e<this.contracts.length;e+=1)this.settings[this.contracts[e].id][t][s].send=i;return}let n=!1;for(let a=0;a<this.contracts.length&&!n;a+=1)this.contracts[a].id!==e&&this.contracts[a].id!==Z&&this.settings[this.contracts[a].id][t][s].send!==i&&(n=!0);this.settings[Z][t][s].send=n?null:i},async apply(){const e=[],t=Object.keys(this.settings);for(let i=0;i<t.length;i+=1){const s=Object.keys(this.settings[t[i]]);for(let n=0;n<s.length;n+=1){const a=Object.keys(this.settings[t[i]][s[n]]);for(let l=0;l<this.methods.length;l+=1)this.contracts[i].id===Z?(this.settings[t[i]][s[n]][a[l]].send||this.settings[t[i]][s[n]][a[l]].forced)&&e.push({contract:t[i],event:s[n],method:a[l]}):!this.settings[t[i]][s[n]][a[l]].send||this.settings[Z][s[n]][a[l]].send||this.settings[Z][s[n]][a[l]].forced||e.push({contract:t[i],event:s[n],method:a[l]})}}const s=await this.$jsonRPC("User::setMessageSettings",{cellphone:this.cellphone,settings:e});"ok"===s.ok&&this.$q.notify({position:"top",timeout:5e3,type:"info",message:"Настройки сохранены."}),this.$emit("ok")}}},te=ee,se=(s("a5c4"),s("eaac")),ie=s("db86"),ne=s("bd08"),ae=s("357e"),le=s("05c0"),oe=Object(c["a"])(te,K,G,!1,null,null,null),re=oe.exports;b()(oe,"components",{QCard:T["a"],QDialog:Q["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QInput:I["a"],QIcon:v["a"],QTable:se["a"],QTd:ie["a"],QToggle:j["a"],QTr:ne["a"],QTh:ae["a"],QTooltip:le["a"],QCardActions:H["a"]}),b()(oe,"directives",{ClosePopup:U["a"]});var ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-card",{staticClass:"q-dialog-plugin",staticStyle:{width:"700px","max-width":"700px"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h6 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n        "+e._s(0===e.number?"Новая заявка":"Заявка "+e.number)+"\n      ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",[s("q-tabs",{directives:[{name:"show",rawName:"v-show",value:0!==e.number,expression:"number !== 0"}],staticClass:"text-primary bg-grey-2",attrs:{dense:"","inline-label":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("q-tab",{attrs:{name:"basic",icon:"fas fa-bell",label:"Основное"}}),s("q-separator",{attrs:{vertical:""}}),s("q-tab",{attrs:{name:"solution",icon:"fas fa-tools",label:"Решение"}}),s("q-separator",{attrs:{vertical:""}}),s("q-tab",{attrs:{name:"log",icon:"fas fa-align-left",label:"Журнал"}}),s("q-separator",{attrs:{vertical:""}}),s("q-tab",{attrs:{name:"docs",icon:"far fa-file",label:"Документы"}}),s("q-separator",{attrs:{vertical:""}}),s("q-tab",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{name:"works",label:"Работы"}})],1),s("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"basic"===e.tab,expression:"tab === 'basic'"}]},[s("q-select",{ref:"selectContragent",attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:"Заказчик",behaviuor:"menu",options:e.contragentsFiltered,readonly:e.contragentsList.length<=1},on:{filter:e.filterContragents,input:e.onContragentChanged},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n              Нет совпадений\n            ")])],1)]},proxy:!0}]),model:{value:e.selectedContragent,callback:function(t){e.selectedContragent=t},expression:"selectedContragent"}}),s("div",{staticClass:"row"},[s("q-select",{ref:"selectContract",staticClass:"col q-pr-sm",attrs:{dense:"","options-dense":"",label:"Договор",behaviuor:"menu",options:e.contractsList,readonly:e.contractsList.length<=1},on:{input:e.onContractChanged},model:{value:e.selectedContract,callback:function(t){e.selectedContract=t},expression:"selectedContract"}}),s("q-select",{ref:"selectDivision",staticClass:"col q-pl-sm",attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:"Подразделение",behaviuor:"menu",options:e.divisionsFiltered,readonly:e.divisionsList.length<=1},on:{filter:e.filterDivisions,input:e.onDivisionChanged},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n                Нет совпадений\n              ")])],1)]},proxy:!0}]),model:{value:e.selectedDivision,callback:function(t){e.selectedDivision=t},expression:"selectedDivision"}})],1),s("div",{staticClass:"row"},[s("q-select",{ref:"selectService",staticClass:"col q-pr-sm",attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"","input-debounce":"0",label:"Услуга",behaviuor:"menu",options:e.servicesFiltered,"option-label":function(e){return e.name+" ("+e.label+")"},readonly:e.servicesList.length<=1},on:{filter:e.filterServices,input:e.onServiceChanged},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n                Нет совпадений\n              ")])],1)]},proxy:!0}]),model:{value:e.selectedService,callback:function(t){e.selectedService=t},expression:"selectedService"}}),s("q-select",{ref:"selectLevel",staticClass:"col q-pl-sm",attrs:{dense:"","options-dense":"",label:"Уровень критичности",behaviuor:"menu",options:e.levelsList,readonly:e.levelsList.length<=1},on:{input:e.onLevelChanged},model:{value:e.selectedLevel,callback:function(t){e.selectedLevel=t},expression:"selectedLevel"}})],1),s("q-input",{staticClass:"q-py-xs",attrs:{type:"textarea",dense:"",outlined:"",label:"Описание проблемы","input-style":"resize: none;"},model:{value:e.problem,callback:function(t){e.problem=t},expression:"problem"}}),s("div",{staticClass:"row"},[s("q-select",{staticClass:"col q-pr-sm",attrs:{"use-input":"","hide-selected":"","fill-input":"",dense:"","options-dense":"",clearable:"","input-debounce":"0",label:"Сервисный номер",behaviuor:"menu",options:e.equipmentFiltered,readonly:!e.canChangeEquipment||0===e.equipmentList.length},on:{filter:e.filterEquipment},scopedSlots:e._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[e._v("\n                Нет совпадений\n              ")])],1)]},proxy:!0}]),model:{value:e.selectedEquipment,callback:function(t){e.selectedEquipment=t},expression:"selectedEquipment"}}),s("q-input",{staticClass:"col q-pl-sm",attrs:{dense:"",label:"Серийный номер",readonly:!0},model:{value:e.selectedEquipmentSerialNumber,callback:function(t){e.selectedEquipmentSerialNumber=t},expression:"selectedEquipmentSerialNumber"}})],1),s("q-input",{attrs:{dense:"",label:"Тип оборудования",readonly:!0},model:{value:e.selectedEquipmentType,callback:function(t){e.selectedEquipmentType=t},expression:"selectedEquipmentType"}}),s("div",{staticClass:"row"},[s("q-input",{staticClass:"col q-pr-sm",attrs:{dense:"",label:"Дата поступления",readonly:!0},model:{value:e.createdAt,callback:function(t){e.createdAt=t},expression:"createdAt"}}),s("q-input",{staticClass:"col q-pl-sm",attrs:{dense:"","options-dense":"",label:"Срок исполнения",readonly:!0},model:{value:e.repairBefore,callback:function(t){e.repairBefore=t},expression:"repairBefore"}})],1),s("div",{staticClass:"row"},[s("q-select",{staticClass:"col q-pr-sm",attrs:{dense:"","options-dense":"",clearable:"",label:"Назначена партнёру",behaviuor:"menu",options:e.partnersList,readonly:!e.canChangePartner||0===e.partnersList.length},model:{value:e.selectedPartner,callback:function(t){e.selectedPartner=t},expression:"selectedPartner"}}),s("q-select",{staticClass:"col q-pl-sm",attrs:{dense:"","options-dense":"",label:"Ответственное лицо",behaviuor:"menu",options:e.contactsList,readonly:!e.canChangeContact||0===e.contactsList.length},model:{value:e.selectedContact,callback:function(t){e.selectedContact=t},expression:"selectedContact"}})],1),s("div",{staticClass:"row"},[s("q-input",{staticClass:"col q-pr-sm",attrs:{dense:"",label:"Электронная почта",readonly:!0},model:{value:e.selectedContactEmail,callback:function(t){e.selectedContactEmail=t},expression:"selectedContactEmail"}}),s("q-input",{staticClass:"col q-pl-sm",attrs:{dense:"","options-dense":"",label:"Телефон",readonly:!0},model:{value:e.selectedContactPhone,callback:function(t){e.selectedContactPhone=t},expression:"selectedContactPhone"}})],1),s("q-input",{attrs:{dense:"","options-dense":"",label:"Адрес нахождения оборудования",readonly:!0},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1),s("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"log"===e.tab,expression:"tab === 'log'"}]},[s("div",{staticStyle:{height:"490px","border-bottom":"1px solid","overflow-y":"scroll"}},[s("q-list",{attrs:{dense:""}},e._l(e.events,(function(t){return s("q-item",{key:t.id},[s("q-item-section",[s("q-item-label",{staticClass:"q-pt-sm",attrs:{lines:"1"}},[s("span",{staticClass:"text-primary"},[e._v("\n                  "+e._s(t.time+":")+"\n                ")]),s("span",{staticClass:"text-primary",staticStyle:{"font-weight":"bold"}},[e._v("\n                  "+e._s(t.user)+"\n                ")])]),t.log?s("q-item-label",{staticClass:"q-pl-md",staticStyle:{"font-weight":"500"}},[e._v("\n                "+e._s(t.log)+"\n              ")]):e._e(),t.comment?s("q-item-label",{staticClass:"q-pl-md"},[e._v("\n                "+e._s(t.comment)+"\n              ")]):e._e(),t.document?s("q-item-label",{staticClass:"q-pl-md"},[s("q-icon",{attrs:{name:t.document.icon,size:"xs"}}),t.document.id?s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),e.getDoc(t.document)}}},[e._v("\n                  "+e._s(t.document.name)+"\n                ")]):s("span",[e._v("\n                  "+e._s(t.document.name)+"\n                ")])],1):e._e()],1)],1)})),1)],1),s("q-input",{attrs:{dense:"",label:"Добавить комментарий",readonly:!e.canComment},scopedSlots:e._u([{key:"append",fn:function(){return[""!==e.comment?s("q-btn",{attrs:{icon:"fas fa-comment-medical",dense:"",round:"",flat:"",disabled:!e.canComment},on:{click:e.doAddComment}}):e._e()]},proxy:!0}]),model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1),s("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"solution"===e.tab,expression:"tab === 'solution'"}]},[s("q-input",{staticClass:"q-py-md",attrs:{type:"textarea",dense:"",outlined:"",label:"Обнаруженная проблема","input-style":"resize: none; height: 144px;",readonly:!0},model:{value:e.solution.problem,callback:function(t){e.$set(e.solution,"problem",t)},expression:"solution.problem"}}),s("q-input",{staticClass:"q-pb-md",attrs:{type:"textarea",dense:"",outlined:"",label:"Решение","input-style":"resize: none; height: 145px;",readonly:!0},model:{value:e.solution.solution,callback:function(t){e.$set(e.solution,"solution",t)},expression:"solution.solution"}}),s("q-input",{attrs:{type:"textarea",dense:"",outlined:"",label:"Рекомендации клиенту","input-style":"resize: none; height: 145px;",readonly:!0},model:{value:e.solution.recomendation,callback:function(t){e.$set(e.solution,"recomendation",t)},expression:"solution.recomendation"}})],1),s("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"docs"===e.tab,expression:"tab === 'docs'"}]},[s("div",{staticStyle:{height:"490px","white-space":"pre-wrap","overflow-y":"scroll"}},[e.documents.length>0?s("q-table",{attrs:{"row-key":"id",flat:"",dense:"","hide-bottom":"",data:e.documents,columns:e.documentsTable,pagination:e.pagination,"rows-per-page-options":[0]},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"body-cell-icon",fn:function(e){return[s("q-td",{attrs:{props:e}},[s("q-icon",{attrs:{name:e.row.document.icon,size:"xs"}})],1)]}},{key:"body-cell-size",fn:function(t){return[s("q-td",{attrs:{props:t}},[e._v("\n              "+e._s(t.row.document.size)+"\n            ")])]}},{key:"body-cell-file",fn:function(t){return[s("q-td",{attrs:{props:t}},[t.row.document.id?s("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),e.getDoc(t.row.document)}}},[e._v("\n                "+e._s(t.row.document.name)+"\n              ")]):s("span",[e._v("\n                "+e._s(t.row.document.name)+"\n              ")])])]}}],null,!1,2192124137)}):s("span",[e._v("\n          Документов нет\n        ")])],1),s("q-file",{attrs:{dense:"",label:"Добавить документ",readonly:!e.canAddDocs},scopedSlots:e._u([{key:"append",fn:function(){return[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:null!==e.file,expression:"file !== null"}],attrs:{icon:"fas fa-times",dense:"",round:"",flat:"",disabled:!e.canAddDocs},on:{click:function(t){e.file=null}}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:null!==e.file,expression:"file !== null"}],attrs:{icon:"fas fa-file-medical",dense:"",round:"",flat:"",disabled:!e.canAddDocs},on:{click:e.doAddDoc}})]},proxy:!0}]),model:{value:e.file,callback:function(t){e.file=t},expression:"file"}})],1),s("q-card-section",{directives:[{name:"show",rawName:"v-show",value:"works"===e.tab,expression:"tab === 'works'"}]},[s("div",{staticStyle:{height:"530px","white-space":"pre-wrap"}},[e._v("\n        Работы\n      ")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"show",rawName:"v-show",value:0!==e.number,expression:"number !== 0"}],attrs:{color:"negative",label:"Отменить",icon:"fas fa-times",size:"sm",disabled:!e.requestChanged},on:{click:e.undoChanges}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:0!==e.number,expression:"number !== 0"}],attrs:{color:"positive",label:"Изменить",icon:"fas fa-check",size:"sm",disabled:!e.requestChanged},on:{click:e.doRequestChange}}),s("q-btn",{directives:[{name:"show",rawName:"v-show",value:0===e.number,expression:"number === 0"}],attrs:{color:"positive",label:"Отправить",icon:"fas fa-bell",size:"sm"},on:{click:e.newRequest}})],1)],1)],1)},de=[];s("ace4"),s("5319"),s("5cc6"),s("2b3d");const ue={received:"Получена",accepted:"Принята",fixed:"Работоспособность восстановлена",repaired:"Работа завершена",closed:"Закрыта",canceled:"Отменена"},pe=[""," K"," M"," G"," T"," P"],he={text:"fas fa-file-alt",video:"fas fa-file-video",audio:"fas fa-file-audio",word:"fas fa-file-word",excel:"fas fa-file-excel",pdf:"fas fa-file-pdf",image:"fas fa-file-image",archive:"fas fa-file-archive",file:"fas fa-file"},me=[{name:"icon",field:"document.icon",label:"",align:"center"},{name:"time",field:"time",label:"Время",align:"left"},{name:"user",field:"user",label:"Пользователь",align:"left"},{name:"size",field:"document.size",label:"Размер",align:"left"},{name:"file",fiels:"document.file",label:"Файл",align:"left"}],ve=["critical","high","medium","low","user"];var fe={name:"Request",props:{number:{type:Number,default:0}},data(){return{changed:!1,contragentsList:[],contragentsFiltered:[],selectedContragent:null,contractsList:[],selectedContract:null,divisionsList:[],divisionsFiltered:[],selectedDivision:null,servicesList:[],servicesFiltered:[],selectedService:null,initialService:null,levelsList:[],selectedLevel:null,initialLevel:null,problem:"",equipmentList:[],equipmentFiltered:[],selectedEquipment:null,initialEquipment:null,canChangeEquipment:!1,partnersList:[],selectedPartner:null,initialPartner:null,canChangePartner:!1,contactsList:[],selectedContact:null,initialContact:null,canChangeContact:!1,createdAt:null,repairBefore:null,initialRepairBefore:null,tab:"basic",comment:"",canComment:!0,solution:{problem:null,solution:null,recomendation:null},file:null,canAddDocs:!0,events:[],documentsTable:me,pagination:{rowsPerPage:0}}},computed:{selectedEquipmentSerialNumber(){return null===this.selectedEquipment?null:this.selectedEquipment.serialNumber},selectedEquipmentType(){return null===this.selectedEquipment?null:this.selectedEquipment.type},selectedContactEmail(){return null===this.selectedContact?null:this.selectedContact.email},selectedContactPhone(){return null===this.selectedContact?null:this.selectedContact.phone},documents(){return this.events.filter((e=>null!==e.document))},address(){return null!==this.selectedDivision&&null!==this.selectedDivision.address?this.selectedDivision.address:null!==this.selectedContract?this.selectedContract.address:null},requestChanged(){return null!==this.selectedService&&this.selectedService.value!==this.initialService||null!==this.selectedLevel&&this.selectedLevel.value!==this.initialLevel||null===this.selectedEquipment&&null!==this.initialEquipment||null!==this.selectedEquipment&&this.selectedEquipment.value!==this.initialEquipment||null===this.selectedPartner&&null!==this.initialPartner||null!==this.selectedPartner&&this.selectedPartner.value!==this.initialPartner||null===this.selectedContact&&null!==this.initialContact||null!==this.selectedContact&&this.selectedContact.value!==this.initialContact}},mounted(){0===this.number?this.fillContragents():this.loadRequest()},methods:{eventView(e){let t=null,s=null,i=null;switch(e.event){case"open":t="Заявка создана";break;case"changeState":t=`Статус заявки изменён на '${ue[e.newState]}'`,"canceled"===e.newState&&(s="Причина отмены: "+e.text);break;case"changeDate":t="Срок завершения перенесён на "+e.text;break;case"changePartner":null===e.text?t="Отменено назначение заявки партнёру":(t="Заявка назначена партнёру",s=e.text);break;case"changeContact":t="Новое контактное лицо",s=e.text;break;case"changeService":t="Услуга изменена",s=e.text;break;case"comment":s=e.text;break;case"onWait":t="Заявка поставлена в ожидание",s="Причина: "+e.text;break;case"offWait":t="Заявка снята с ожидания",s="Комментарий: "+e.text;break;case"unClose":t="Отказано в закрытии заявки",s="Причина: "+e.text;break;case"unCancel":t="Заявка открыта повторно",s="Причина: "+e.text;break;case"eqChange":t="Изменено оборудование",s=e.text;break;case"addDocument":t="Добавлен документ",e.document&&(i={id:e.document.id,name:e.document.name,size:this.formatSize(e.document.size),icon:this.mimeIcon(e.document.type)});break;default:}return{id:e.id,time:e.time,user:e.user,log:t,comment:s,document:i}},formatSize(e){let t=parseFloat(e),s=0;while(t>1024)t/=1024,s+=1;return t=t.toPrecision(4),s=pe[s],`${t}${s}`},mimeIcon(e){const t=e.split("/");switch(t[0]){case"text":case"video":case"audio":case"image":return he[t[0]];case"application":switch(t[1]){case"pdf":return he.pdf;case"msword":case"vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/vnd.oasis.opendocument.text":return he.word;case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":case"application/vnd.oasis.opendocument.spreadsheet":return he.excel;case"zip":case"x-rar-compressed":case"x-7z-compressed":return he.archive;default:return he.file}default:return he.file}},sortByName(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())},sortLevels(e,t){return ve.indexOf(e.id)-ve.indexOf(t.id)},sortEquipment(e,t){return e.serviceNumber.toLowerCase().localeCompare(t.serviceNumber.toLowerCase())},listMapper(e){return{value:e.id,label:e.name,default:void 0!==e.default&&e.default}},listWithAddressMapper(e){return{value:e.id,label:e.name,address:e.address,default:void 0!==e.default&&e.default}},servicesMapper(e){return{value:e.id,label:e.shortName,name:e.name,default:void 0!==e.default&&e.default,autoOnly:e.autoOnly}},equipmentMapper(e){return{value:e.id,label:`${e.serviceNumber} - ${e.manufacturer} ${e.model}`,serialNumber:e.serialNumber,type:`${e.type} / ${e.subType}`,default:void 0!==e.default&&e.default}},contactMapper(e){return{value:e.id,label:e.name,email:e.email,phone:e.phone,default:void 0!==e.default&&e.default}},fillList(e,t=this.listMapper,s=this.sortByName,i=!1){const n=e.sort(s).map(t);let a=n.find((e=>e.default));return void 0===a&&(i||0===n.length?a=null:[a]=n),[n,a,null===a?null:a.value]},async loadRequest(){const e=await this.$jsonRPC("Request::getRequest",{number:this.number});[this.contragentsList,this.selectedContragent]=this.fillList(e.contragents),[this.contractsList,this.selectedContract]=this.fillList(e.contracts,this.listWithAddressMapper),[this.divisionsList,this.selectedDivision]=this.fillList(e.divisions,this.listWithAddressMapper),[this.servicesList,this.selectedService,this.initialService]=this.fillList(e.services,this.servicesMapper),[this.levelsList,this.selectedLevel,this.initialLevel]=this.fillList(e.levels,void 0,this.sortLevels),[this.equipmentList,this.selectedEquipment,this.initialEquipment]=this.fillList(e.equipment,this.equipmentMapper,this.sortEquipment,!0),this.canChangeEquipment=e.canChangeEquipment,[this.partnersList,this.selectedPartner,this.initialPartner]=this.fillList(e.partners,void 0,void 0,!0),this.canChangePartner=e.canChangePartner,[this.contactsList,this.selectedContact,this.initialContact]=this.fillList(e.contacts,this.contactMapper),this.problem=e.problem,this.createdAt=e.createdAt,this.repairBefore=e.repairBefore,this.initialRepairBefore=e.repairBefore,this.solution={problem:e.solution.problem,solution:e.solution.solution,recomendation:e.solution.recomendation},this.events=e.events.sort(((e,t)=>{const s=_["b"].extractDate(e.time,"DD.MM.YYYY HH:mm"),i=_["b"].extractDate(t.time,"DD.MM.YYYY HH:mm");return s<i?-1:s>i?1:e.id-t.id})).map(this.eventView)},undoChanges(){this.selectedService=this.servicesList.find((e=>e.value===this.initialService)),this.selectedLevel=this.levelsList.find((e=>e.value===this.initialLevel)),this.selectedEquipment=null===this.initialEquipment?null:this.equipmentList.find((e=>e.value===this.initialEquipment)),this.selectedPartner=null===this.initialPartner?null:this.partnersList.find((e=>e.value===this.initialPartner)),this.selectedContact=null===this.initialContact?null:this.contactsList.find((e=>e.value===this.initialContact)),this.repairBefore=this.initialRepairBefore},filterContragents(e,t){""===e&&t((()=>{this.contragentsFiltered=this.contragentsList}));const s=e.toLowerCase();t((()=>{this.contragentsFiltered=this.contragentsList.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},filterDivisions(e,t){""===e&&t((()=>{this.divisionsFiltered=this.divisionsList}));const s=e.toLowerCase();t((()=>{this.divisionsFiltered=this.divisionsList.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},filterServices(e,t){""===e&&t((()=>{this.servicesFiltered=this.servicesList}));const s=e.toLowerCase();t((()=>{this.servicesFiltered=this.servicesList.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},filterEquipment(e,t){""===e&&t((()=>{this.equipmentFiltered=this.equipmentList}));const s=e.toLowerCase();t((()=>{this.equipmentFiltered=this.equipmentList.filter((e=>e.label.toLowerCase().indexOf(s)>-1))}))},async fillContragents(){const e=await this.$jsonRPC("Contragent::getAllowed",{});[this.contragentsList,this.selectedContragent]=this.fillList(e,this.listWithAddressMapper,void 0,!0),1===this.contragentsList.length&&([this.selectedContragent]=this.contragentsList),null===this.selectedContragent?setTimeout(this.$refs.selectContragent.showPopup,100):this.onContragentChanged()},onContragentChanged(){null===this.selectedContragent?(this.contractsList=[],this.selectedContract=null,this.onContractChanged()):this.fillContracts()},async fillContracts(){const e=await this.$jsonRPC("Contract::getAllowed",{contragent:this.selectedContragent.value});[this.contractsList,this.selectedContract]=this.fillList(e,void 0,void 0,!0),1===this.contractsList.length&&([this.selectedContract]=this.contractsList),null===this.selectedContract?setTimeout(this.$ref.selectContract.showPopup,100):this.onContractChanged()},onContractChanged(){null===this.selectedContract?(this.divisionsList=[],this.selectedDivision=null,this.onDivisionChanged()):this.fillDivisions()},async fillDivisions(){const e=await this.$jsonRPC("Division::getAllowed",{contract:this.selectedContract.value});[this.divisionsList,this.selectedDivision]=this.fillList(e,this.listWithAddressMapper,void 0,!0),1===this.divisionsList.length&&([this.selectedDivision]=this.divisionsList),null===this.selectedDivision?setTimeout(this.$refs.selectDivision.showPopup,100):this.onDivisionChanged()},onDivisionChanged(){null===this.selectedDivision?(this.servicesList=[],this.selectedService=null,this.equipmentList=[],this.selectedEquipment=null,this.partnersList=[],this.selectedPartner=null,this.contactsList=[],this.selectedContact=null,this.onServiceChanged()):(this.fillServices(),this.fillEquipment(),this.fillPartners(),this.fillContacts())},async fillServices(){const e=await this.$jsonRPC("Service::getAllowed",{division:this.selectedDivision.value});[this.servicesList,this.selectedService]=this.fillList(e,this.servicesMapper,void 0,!0),1===this.servicesList.length&&([this.selectedService]=this.servicesList),null===this.selectedService?setTimeout(this.$refs.selectService.showPopup,100):this.onServiceChanged()},onServiceChanged(){null===this.selectedService?(this.levelsList=[],this.selectedLevel=null,this.onLevelChanged()):this.fillLevels()},async fillLevels(){const e=await this.$jsonRPC("Service::getLevels",{division:this.selectedDivision.value,service:this.selectedService.value});[this.levelsList,this.selectedLevel]=this.fillList(e,void 0,this.sortLevels,!0),1===this.levelsList.length&&([this.selectedLevel]=this.levelsList),null===this.selectedLevel?setTimeout(this.$refs.selectLevel.showPopup,100):this.onLevelChanged()},async fillEquipment(){const e=await this.$jsonRPC("Equipment::getAllowed",{division:this.selectedDivision.value});[this.equipmentList,this.selectedEquipment]=this.fillList(e,this.equipmentMapper,this.sortEquipment,!0),this.canChangeEquipment=!0},async fillPartners(){const e=await this.$jsonRPC("Partner::getAllowed",{division:this.selectedDivision.value});[this.partnersList,this.selectedPartner]=this.fillList(e,void 0,void 0,!0),this.canChangePartner=!0},async fillContacts(){const e=await this.$jsonRPC("Contact::getAllowed",{division:this.selectedDivision.value});[this.contactsList,this.selectedContact]=this.fillList(e,this.contactMapper),this.canChangeContact=!0},async onLevelChanged(){const e=await this.$jsonRPC("Request::calcTime",{division:this.selectedDivision.value,service:this.selectedService.value,level:this.selectedLevel.value,createdAt:0===this.number?null:this.createdAt});this.createdAt=e.createdAt,this.repairBefore=e.repairBefore},async newRequest(){if(this.problem.trim().length<10)return void this.$q.notify({position:"top",timeout:5e3,type:"warning",message:"Опишите проблему подробнее."});const e=await this.$jsonRPC("Request::new",{division:this.selectedDivision.value,service:this.selectedService.value,level:this.selectedLevel.value,problem:this.problem.trim(),equipment:null===this.selectedEquipment?null:this.selectedEquipment.value,partner:null===this.selectedPartner?null:this.selectedPartner.value,contact:null===this.selectedContact?null:this.selectedContact.value});"ok"===e.ok&&(this.$q.notify({position:"top",timeout:5e3,type:"info",message:`Создана заявка №${e.number}.`}),this.$emit("close"))},async doAddComment(){const e=this.comment.trim();if(""===e)return;const t=await this.$jsonRPC("Request::addComment",{number:this.number,comment:e});"ok"===t.ok&&(this.$q.notify({position:"top",timeout:5e3,type:"info",message:`Добавлен комментарий к заявке №${this.number}.`}),this.comment="",this.events.push(this.eventView(t.event)))},readFile(e){return new Promise((t=>{const s=new FileReader;s.onloadend=()=>{t(s.result.replace(/^data:.+;base64,/,""))},s.readAsDataURL(e)}))},async doAddDoc(){if(null===this.file)return;const e=await this.readFile(this.file),t=await this.$jsonRPC("Request::addDocument",{number:this.number,name:this.file.name,size:this.file.size,content:e});"ok"===t.ok&&(this.$q.notify({position:"top",timeout:5e3,type:"info",message:`Документ '${this.file.name} добавлен к заявке №${this.number}.`}),this.file=null,this.events.push(this.eventView(t.event)))},base64_decode(e){const t=atob(e),s=new Uint8Array(t.length);for(let i=0;i<t.length;i+=1)s[i]=t.charCodeAt(i);return s},async getDoc(e){const t=await this.$jsonRPC("Request::getDocument",{id:e.id});if("ok"===t.ok){const s=this.base64_decode(t.content),i=new Blob([s],{type:t.type}),n=window.URL.createObjectURL(i),a=document.createElement("a");a.style="display: none",a.href=n,a.setAttribute("download",e.name),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},async doRequestChange(){if(!this.requestChanged)return;const e={number:this.number};this.selectedService.value!==this.initialService&&(e.service=this.selectedService.value),this.selectedLevel.value!==this.initialLevel&&(e.level=this.selectedLevel.value),(null===this.selectedEquipment&&null!==this.initialEquipment||null!==this.selectedEquipment&&this.selectedEquipment.value!==this.initialEquipment)&&(e.equipment=null===this.selectedEquipment?null:this.selectedEquipment.value),(null===this.selectedPartner&&null!==this.initialPartner||null!==this.selectedPartner&&this.selectedPartner.value!==this.initialPartner)&&(e.partner=null===this.selectedPartner?null:this.selectedPartner.value),(null===this.selectedContact&&null!==this.initialContact||null!==this.selectedContact&&this.selectedContact.value!==this.initialContact)&&(e.contact=null===this.selectedContact?null:this.selectedContact.value);const t=await this.$jsonRPC("Request::change",e);"ok"===t.ok&&(this.$q.notify({position:"top",timeout:5e3,type:"info",message:`Данные заявки №${this.number} изменены.`}),this.$emit("close"))}}},be=fe,qe=s("429b"),ge=s("7460"),we=s("eb85"),ye=s("1c1c"),Ce=s("7d53"),xe=Object(c["a"])(be,ce,de,!1,null,null,null),ke=xe.exports;b()(xe,"components",{QCard:T["a"],QDialog:Q["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QTabs:qe["a"],QTab:ge["a"],QSeparator:we["a"],QSelect:z["a"],QItem:O["a"],QItemSection:E["a"],QInput:I["a"],QList:ye["a"],QItemLabel:M["a"],QIcon:v["a"],QTable:se["a"],QTd:ie["a"],QFile:Ce["a"],QCardActions:H["a"]}),b()(xe,"directives",{ClosePopup:U["a"]});var De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:e.onDialogHide}},[s("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h5 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n          "+e._s(e.header)+"\n        ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",{staticClass:"q-pa-sm"},[s("q-card-section",{staticClass:"q-pa-xs"},[s("q-input",{ref:"text",attrs:{label:e.label,dense:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:e.icon}})]},proxy:!0}]),model:{value:e.text,callback:function(t){e.text=t},expression:"text"}})],1),s("q-card-actions",{staticClass:"q-pa-xs",attrs:{align:"right"}},[s("q-btn",{attrs:{type:"submit",color:"primary",label:"ОК",icon:"fas fa-check",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onOkClick(t)}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"negative",label:"Отмена",icon:"fas fa-times",size:"sm"}})],1)],1)],1)],1)},Le=[],Se={name:"CustomPrompt",props:{header:{type:String,default:"Ответ"},label:{type:String,default:"Ответ"},icon:{type:String,default:"fas fa-question"}},data(){return{text:""}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOkClick(){this.$emit("ok",this.text.trim()),this.hide()}}},Re=Se,_e=Object(c["a"])(Re,De,Le,!1,null,null,null),Pe=_e.exports;b()(_e,"components",{QDialog:Q["a"],QCard:T["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QInput:I["a"],QIcon:v["a"],QCardActions:H["a"]}),b()(_e,"directives",{ClosePopup:U["a"]});var Ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:e.onDialogHide}},[s("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h5 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n          Решение проблемы\n        ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",{staticClass:"q-pa-sm"},[s("q-card-section",{staticClass:"q-pa-xs"},[s("q-input",{staticClass:"q-pb-xs",attrs:{type:"textarea",label:"Обнаруженная проблема","input-style":"resize: none;",dense:"",outlined:""},model:{value:e.problem,callback:function(t){e.problem=t},expression:"problem"}}),s("q-input",{staticClass:"q-pb-xs",attrs:{type:"textarea",label:"Решение","input-style":"resize: none;",dense:"",outlined:""},model:{value:e.solution,callback:function(t){e.solution=t},expression:"solution"}}),s("q-input",{attrs:{type:"textarea",label:"Рекомендации клиенту","input-style":"resize: none;",dense:"",outlined:""},model:{value:e.recomendation,callback:function(t){e.recomendation=t},expression:"recomendation"}})],1),s("q-card-actions",{staticClass:"q-pa-xs",attrs:{align:"right"}},[s("q-btn",{attrs:{type:"submit",color:"primary",label:"ОК",icon:"fas fa-check",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onOkClick(t)}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"negative",label:"Отмена",icon:"fas fa-times",size:"sm"}})],1)],1)],1)],1)},$e=[],Te={name:"CustomPromptSolution",data(){return{problem:"",solution:"",recomendation:""}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOkClick(){this.$emit("ok",{problem:this.problem.trim(),solution:this.solution.trim(),recomendation:this.recomendation.trim()}),this.hide()}}},Qe=Te,Ne=Object(c["a"])(Qe,Ae,$e,!1,null,null,null),Fe=Ne.exports;b()(Ne,"components",{QDialog:Q["a"],QCard:T["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QInput:I["a"],QCardActions:H["a"]}),b()(Ne,"directives",{ClosePopup:U["a"]});var ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:e.onDialogHide}},[s("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h5 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n          "+e._s(e.header)+"\n        ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",{staticClass:"q-pa-sm"},[s("q-card-section",{staticClass:"q-pa-xs"},[s("q-input",{ref:"text",attrs:{label:e.label,dense:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:e.icon}})]},proxy:!0}]),model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),s("q-input",{attrs:{label:e.dateLabel,readonly:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{staticClass:"cursor-pointer",attrs:{name:"fas fa-calendar"}},[s("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[s("q-date",{attrs:{minimal:"",mask:"DD.MM.YYYY",options:e.options},on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}})],1)],1)]},proxy:!0},{key:"append",fn:function(){return[s("q-icon",{directives:[{name:"show",rawName:"v-show",value:null!==e.selectedDate,expression:"selectedDate !== null"}],staticClass:"cursor-pointer",attrs:{name:"fas fa-times"},on:{click:function(t){e.selectedDate=null}}})]},proxy:!0}]),model:{value:e.selectedDate,callback:function(t){e.selectedDate=t},expression:"selectedDate"}})],1),s("q-card-actions",{staticClass:"q-pa-xs",attrs:{align:"right"}},[s("q-btn",{attrs:{type:"submit",color:"primary",label:"ОК",icon:"fas fa-check",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onOkClick(t)}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"negative",label:"Отмена",icon:"fas fa-times",size:"sm"}})],1)],1)],1)],1)},Oe=[],Ee={name:"CustomPromptWithDate",props:{header:{type:String,default:"Ответ"},label:{type:String,default:"Ответ"},icon:{type:String,default:"fas fa-question"},dateLabel:{type:String,default:"Дата"}},data(){return{text:"",selectedDate:null,currentDate:_["b"].formatDate(Date.now(),"YYYY/MM/DD")}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOkClick(){this.$emit("ok",{text:this.text.trim(),date:null===this.selectedDate?null:_["b"].formatDate(_["b"].extractDate(this.selectedDate,"DD.MM.YYYY"),"YYYY-MM-DD")}),this.hide()},options(e){return e>this.currentDate}}},Me=Ee,je=Object(c["a"])(Me,ze,Oe,!1,null,null,null),Ie=je.exports;b()(je,"components",{QDialog:Q["a"],QCard:T["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QInput:I["a"],QIcon:v["a"],QPopupProxy:W["a"],QDate:Y["a"],QCardActions:H["a"]}),b()(je,"directives",{ClosePopup:U["a"]});var Be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:e.onDialogHide}},[s("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[s("q-card-section",{staticClass:"bg-primary text-white text-center text-h5 q-pa-xs"},[s("q-toolbar",[s("q-toolbar-title",[e._v("\n          "+e._s(e.header)+"\n        ")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"fas fa-times"}})],1)],1),s("q-form",{staticClass:"q-pa-sm"},[s("q-card-section",{staticClass:"q-pa-xs"},[s("q-select",{attrs:{dense:"","options-dense":"",label:e.label,options:e.options},scopedSlots:e._u([{key:"prepend",fn:function(){return[s("q-icon",{attrs:{name:e.icon}})]},proxy:!0}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),s("q-card-actions",{staticClass:"q-pa-xs",attrs:{align:"right"}},[s("q-btn",{attrs:{type:"submit",color:"primary",label:"ОК",icon:"fas fa-check",size:"sm"},on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.onOkClick(t)}}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"negative",label:"Отмена",icon:"fas fa-times",size:"sm"}})],1)],1)],1)],1)},We=[],Ye={name:"CustomPrompt",props:{header:{type:String,default:"Ответ"},label:{type:String,default:"Ответ"},icon:{type:String,default:"fas fa-question"},options:{type:Array,default(){return[]}},current:{type:Object,default(){return{label:"",value:null}}}},data(){return{selected:this.current}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onDialogHide(){this.$emit("hide")},onOkClick(){this.$emit("ok",this.selected),this.hide()}}},He=Ye,Ue=Object(c["a"])(He,Be,We,!1,null,null,null),Ve=Ue.exports;b()(Ue,"components",{QDialog:Q["a"],QCard:T["a"],QCardSection:N["a"],QToolbar:u["a"],QToolbarTitle:h["a"],QBtn:m["a"],QForm:F["a"],QSelect:z["a"],QIcon:v["a"],QCardActions:H["a"]}),b()(Ue,"directives",{ClosePopup:U["a"]});const Je={received:{icon:"far fa-bell",label:"Новые",badgeColor:"negative",show:0,total:0,states:["preReceived","received"]},accepted:{icon:"fas fa-hammer",label:"В работе",badgeColor:"accent",show:0,total:0,states:["accepted","fixed"]},repaired:{icon:"fas fa-tools",label:"Ждут закрытия",badgeColor:"info",show:0,total:0,states:["repaired"]},closed:{icon:"fas fa-check-double",label:"Закрытые",badgeColor:"positive",show:0,total:0,states:["closed"]},canceled:{icon:"far fa-bell-slash",label:"Отменённые",badgeColor:"positive",show:0,total:0,states:["canceled"]},planned:{icon:"far fa-calendar-alt",label:"Плановые",badgeColor:"info",show:0,total:0,states:["planned"]}},Ke=[{name:"icons",label:"",field:"state",align:"left"},{name:"number",label:"Номер",field:"number",align:"right",sortable:!0},{name:"level",label:"Уровень",field:"slaLevel",align:"left"},{name:"service",label:"Услуга",field:"service",align:"left"},{name:"received",label:"Поступила",field:"createdAt",align:"left"},{name:"repair",label:"Выполнить до",field:"repairBefore",align:"left"},{name:"contragent",label:"Заказчик",field:"contragent",align:"left",style:"max-width: 150px; overflow: hidden; text-overflow: ellipsis;"},{name:"division",label:"Подразделение",field:"division",align:"left",style:"max-width: 250px; overflow: hidden; text-overflow: ellipsis;"},{name:"engineer",label:"Ответственный",field:"engineer",align:"left"},{name:"time",label:"Осталось",field:"time",align:"center"}],Ge=[{name:"icons",label:"",field:"state",align:"left"},{name:"level",label:"Уровень",field:"slaLevel",align:"left"},{name:"service",label:"Услуга",field:"service",align:"left"},{name:"date",label:"Дата",field:"date",align:"left"},{name:"contragent",label:"Заказчик",field:"contragent",align:"left",style:"max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: pre-line;"},{name:"problem",label:"Задача",field:"problem",align:"left",style:"white-space: pre-line;"}],Xe={preReceived:{icon:"fas fa-bell",color:"negative",tooltip:"Получена",tab:"received"},received:{icon:"fas fa-bell",color:"negative",tooltip:"Получена",tab:"received"},accepted:{icon:"fas fa-hammer",color:"info",tooltip:"Принята в работу",tab:"accepted"},fixed:{icon:"fas fa-tape",color:"info",tooltip:"Работоспособность восстановлена",tab:"accepted"},repaired:{icon:"fas fa-tools",color:"positive",tooltip:"Работы завершены",tab:"repaired"},closed:{icon:"fas fa-check",color:"positive",tooltip:"Закрыта",tab:"closed"},canceled:{icon:"fas fa-bell-slash",color:"warning",tooltip:"Отменена",tab:"canceled"},planned:{icon:"fas fa-calendar-alt",color:"info",tooltip:"Плановая",tab:"planned"},wait:{icon:"fas fa-stopwatch",color:"accent",tooltip:"Приостановлена"},sync1C:{icon:"fas fa-exclamation-triangle",color:"warning",tooltip:"Нет синхронизации с 1С"},partner:{icon:"fas fa-hands-helping",color:"info",tooltip:"Передана партнёру"},comment:{icon:"fas fa-comment-medical",color:"grey",tooltip:"Комментарий"}};var Ze={name:"TechSupport",components:{MainHeader:g,MainFooter:L,FilterDialog:J,MessageSettingsDialog:re,Request:ke},data(){return{miniState:!0,drawerForceOpen:!1,showFilterSetup:!1,showMessageSettings:!1,filter:{contragent:null,contract:null,division:null,divisionType:null,partner:null,excludedServices:[],text:"",interval:"3m",fromDate:null,toDate:null},splitter:130,selectedTab:"received",tabs:Je,mainTable:Ke,plannedTable:Ge,pagination:{rowsPerPage:0},states:Xe,requests:[],activeRequest:{number:0},allowedActions:{},rateInterval:null,showRequest:!1,showWaitOn:!0,lockNumber:!1}},computed:{filterIconColor(){return null!==this.filter.contragent||null!==this.filter.contract||null!==this.filter.division||null!==this.filter.divisionType||null!==this.filter.partner||0!==this.filter.excludedServices.length||""!==this.filter.text||null!==this.filter.fromDate||null!==this.filter.toDate?"accent":"black"},isClient(){return!this.$store.state.auth.isAuthorized||"client"===this.$store.getters["auth/payload"].rights},canAccept(){return this.canDoAction("accept")&&this.$store.getters["auth/payload"].partner===this.activeRequest.partner.id},canChangePartner(){return this.canDoAction("change_partner")&&this.activeRequest.hasPartners},canFix(){return this.canDoAction("fix")&&this.$store.getters["auth/payload"].partner===this.activeRequest.partner.id},canRepair(){return this.canDoAction("repair")&&this.$store.getters["auth/payload"].partner===this.activeRequest.partner.id},canClose(){return this.canDoAction("close")},canDeny(){return this.canDoAction("deny")},canCancel(){return this.canDoAction("cancel")},canUnCancel(){return this.canDoAction("unCancel")},canReopen(){return this.canDoAction("reopen")},canDoNow(){return this.canDoAction("doNow")&&this.activeRequest.state.canGet&&("partner"!==this.$store.getters["auth/payload"].rights||this.activeRequest.partners.includes(this.$store.getters["auth/payload"].partner))},canWaitOn(){return this.canDoAction("waitOn")&&!this.waitState},canWaitOff(){return this.canDoAction("waitOff")&&this.waitState},syncedState(){return 0!==this.activeRequest.number&&("planned"===this.activeRequest.state.current||null!==this.activeRequest.state.sync1C)},waitState(){return 0!==this.activeRequest.number&&this.activeRequest.state.wait}},mounted(){const e=localStorage.getItem("filter");null!==e&&(this.filter=JSON.parse(e)),this.getAllowedActions(),this.refreshRequests(),this.rateInterval=setInterval(this.updateRates,1e3)},beforeDestroy(){null!==this.rateInterval&&(clearInterval(this.rateInterval),this.rateInterval=null)},methods:{onChangeTab(){this.requests=[],this.refreshRequests()},refreshRequests(){this.getCounts(),"planned"===this.selectedTab?this.getPlannedRequests():this.getRequests()},onUpdateRequest(){this.showRequest=!1,this.activeRequest={number:0},this.requests=[],this.refreshRequests()},async updateRates(){const e=this.requests.filter((e=>void 0!==e.time&&(null===e.time.reactRate||null===e.time.fixRate||null===e.time.repairRate))).slice(0,10).map((e=>e.number));if(0===e.length)return;const t=await this.$jsonRPC("Request::getRates",{numbers:e},!0);Object.keys(t).forEach((e=>{const s=this.requests.find((t=>+t.number===+e));if(void 0===s)return;s.time.reactRate=t[e].reactRate,s.time.fixRate=t[e].fixRate,s.time.repairRate=t[e].repairRate;const i=Math.max(0,Math.round(120*(1-s.time.reactRate))),n=Math.max(0,Math.round(120*(1-s.time.fixRate))),a=Math.max(0,Math.round(120*(1-s.time.repairRate)));s.time.reactColor=`hsl(${i},100%,40%)`,s.time.fixColor=`hsl(${n},100%,40%)`,s.time.repairColor=`hsl(${a},100%,40%)`}))},setFilter(e){this.filter=e,this.showFilterSetup=!1,this.refreshRequests()},showContextMenu(e){const t=e.target.closest("tr").cells[0].dataset.number;this.activeRequest=this.requests.find((e=>+e.number===+t)),this.lockNumber=!1},hideContextMenu(){this.lockNumber||(this.activeRequest={number:0})},async getAllowedActions(){this.allowedActions=await this.$jsonRPC("User::getAllowedActions",{})},async getCounts(){const e=await this.$jsonRPC("Request::getCounts",{filter:this.filter});Object.values(Je).forEach((e=>{e.show=0,e.total=0})),Object.keys(e.total).forEach((t=>{this.tabs[this.states[t].tab].total+=e.total[t]})),Object.keys(e.filtered).forEach((t=>{this.tabs[this.states[t].tab].show+=e.filtered[t]}));const t=await this.$jsonRPC("PlannedRequest::getCounts",{filter:this.filter});this.tabs.planned.total+=t.total,this.tabs.planned.show+=t.filtered},async getRequests(){const e=await this.$jsonRPC("Request::getList",{filter:this.filter,states:this.tabs[this.selectedTab].states});this.requests=e.sort(((e,t)=>e.number-t.number)).map((e=>{let t;if(null===e.time.fixedAt&&(e.time.fixedAt=e.time.repairedAt),"canceled"===e.state.current)t="Заявка отменена",e.time.reactRate=0,e.time.fixRate=0,e.time.repairRate=0;else{const s="Поступила "+e.time.createdAt;let i,n;i=null!==e.time.fixedAt?"\nВосстановлена "+e.time.fixedAt:e.wait?"\nПриостановлена "+e.time.waitFrom:"\nВосстановить до "+e.time.fixBefore,n=null!==e.time.repairedAt?"\nЗавершена "+e.time.repairedAt:e.wait?null===e.time.fixedAt?"":"\nПриостановлена "+e.time.waitFrom:"\nЗавершить до "+e.time.repairBefore,t=`${s}${i}${n}`}const s=Math.max(0,Math.round(120*(1-e.time.reactRate))),i=Math.max(0,Math.round(120*(1-e.time.fixRate))),n=Math.max(0,Math.round(120*(1-e.time.repairRate)));return{number:e.number,state:e.state,slaLevel:e.slaLevel,partner:e.partner,waitTo:e.time.waitTo,service:{text:e.service.shortName,tooltip:`${e.service.name}\n${e.problem}`},createdAt:e.time.createdAt,repairBefore:e.time.repairBefore,contragent:{text:e.contragent,tooltip:"Договор "+e.contract},division:{text:e.division,tooltip:`Контактное лицо: ${e.contact.name}\nE-mail: ${e.contact.email}\nТелефон: ${e.contact.phone}`},engineer:null===e.engineer?{name:null,tooltip:null}:{text:e.engineer.shortName,tooltip:`${e.engineer.name}\nE-mail: ${e.engineer.email}\nТелефон: ${e.engineer.phone}`},time:{reactRate:e.time.reactRate,reactColor:null===e.time.reactRate?"hsl(240,100%,80%)":`hsl(${s},100%,40%)`,fixRate:e.time.fixRate,fixColor:null===e.time.fixRate?"hsl(240,100%,80%)":`hsl(${i},100%,40%)`,repairRate:e.time.repairRate,repairColor:null===e.time.repairRate?"hsl(240,100%,80%)":`hsl(${n},100%,40%)`,tooltip:t},hasPartners:e.hasPartners}}))},async getPlannedRequests(){const e=await this.$jsonRPC("PlannedRequest::getList",{filter:this.filter});this.requests=e.sort(((e,t)=>e.date.localeCompare(t.date))).map((e=>({number:e.number,state:e.state,slaLevel:e.slaLevel,service:{text:e.service.shortName,tooltip:e.service.name},partner:e.partner,date:e.date,contragent:e.contragent===e.division?e.contragent:`${e.division},\n${e.contragent}`,problem:`${e.problem}\n${e.addProblem}`,partners:e.partners})))},async getPartners(e){const t=await this.$jsonRPC("Request::getPartners",{number:e});return t.map((e=>({value:e.id,label:e.name})))},canDoAction(e){if(!this.$store.state.auth.isAuthorized||0===this.activeRequest.number)return!1;const{rights:t}=this.$store.getters["auth/payload"],s=this.activeRequest.state.current;return this.allowedActions[t][s].includes(e)},async doWithParams(e,t,s){const i=await this.$jsonRPC(e,t);"ok"===i.ok&&(this.$q.notify({position:"top",timeout:5e3,type:"info",message:s}),this.onUpdateRequest())},do(e,t){this.doWithParams(e,{number:this.activeRequest.number},t)},doAccept(){this.do("Request::accept",`Заявка №${this.activeRequest.number} принята в работу.`)},doFix(){this.do("Request::fix",`Заявка №${this.activeRequest.number}: работоспособность восстановлена.`)},doClose(){this.do("Request::close",`Заявка №${this.activeRequest.number} закрыта.`)},async doWithCause(e,t,s,i){this.lockNumber=!0;let n=await this.prompt(e,t);n=null===n?"":n.trim(),""!==n?(await this.doWithParams(s,{number:this.activeRequest.number,cause:n},i),this.activeRequest={number:0}):this.activeRequest={number:0}},doCancel(){this.doWithCause("Отмена заявки","Причина отмены","Request::cancel",`Заявка №${this.activeRequest.number} отменена.`)},doUnCancel(){this.doWithCause("Повторное открытие заявки","Причина повторного открытия","Request::unCancel",`Заявка №${this.activeRequest.number} открыта повторно.`)},async doReopen(){this.doWithCause("Повторное открытие заявки","Причина повторного открытия","Request::reopen",`Заявка №${this.activeRequest.number} открыта повторно.`)},async doDeny(){this.doWithCause("Отказ в закрытии заявки","Причина отказа","Request::deny",`В закрытии заявки №${this.activeRequest.number} отказано.`)},async doWaitOff(){this.doWithCause("Возобновление выполнения заявки","Комментарий","Request::waitOff",`Выполнение заявки №${this.activeRequest.number} возобновлено.`)},async doRepair(){this.lockNumber=!0;const e=await this.promptSolution();null!==e&&""!==e.problem&&""!==e.solution?(await this.doWithParams("Request::repair",{number:this.activeRequest.number,solution:e},`Заявка №${this.activeRequest.number}: работы завершены.`),this.activeRequest={number:0}):this.activeRequest={number:0}},async doWaitOn(){this.lockNumber=!0;const{text:e,date:t}=await this.promptWithDate("Приостановка выполнения заявки","Причина приостановки","fas fa-question","Дата возобновления работ"),s=null===e?"":e.trim();""!==s?(await this.doWithParams("Request::waitOn",{number:this.activeRequest.number,cause:s,date:t},`Выполнение заявки №${this.activeRequest.number} приостановлено.`),this.activeRequest={number:0}):this.activeRequest={number:0}},async doChangePartner(){const e=await this.getPartners(this.activeRequest.number);e.sort(((e,t)=>e.label.toLowerCase().localeCompare(t.label.toLowerCase()))).unshift({value:null,label:"Отменить назначение"});let t=e.filter((e=>e.value===this.activeRequest.partner.id));0===t.length?[t]=e:[t]=t,this.lockNumber=!0;const s=await this.promptWithSelect("Назначение заявки партнёру","Партнёр",Xe.partner.icon,e,t);null!==s&&s.value!==this.activeRequest.partner.id?(await this.doWithParams("Request::setPartner",{number:this.activeRequest.number,partnerId:s.value},`Изменено назначение заявки №${this.activeRequest.number} партнёру.`),this.activeRequest={number:0}):this.activeRequest={number:0}},async doAddComment(){this.lockNumber=!0;let e=await this.prompt("Комментарий к заявке","Текст комментария");e=null===e?"":e.trim(),""!==e?(await this.doWithParams("Request::addComment",{number:this.activeRequest.number,comment:e},`Добавлен комментарий к заявке №${this.activeRequest.number}.`),this.activeRequest={number:0}):this.activeRequest={number:0}},doDoNow(){this.do("PlannedRequest::doNow","Плановая заявка активирована.")},doOpen(){this.lockNumber=!0,this.showRequest=!0},prompt(e="",t="",s="fas fa-question"){return new Promise((i=>{this.$q.dialog({component:Pe,parent:this,header:e,label:t,icon:s,cancel:!0,persistent:!0}).onOk((e=>{i(e)})).onCancel((()=>{i(null)}))}))},promptSolution(){return new Promise((e=>{this.$q.dialog({component:Fe,parent:this,cancel:!0,persistent:!0}).onOk((t=>{e(t)})).onCancel((()=>{e(null)}))}))},promptWithDate(e="",t="",s="fas fa-question",i=""){return new Promise((n=>{this.$q.dialog({component:Ie,parent:this,header:e,label:t,dateLabel:i,icon:s,cancel:!0,persistent:!0}).onOk((e=>{n(e)})).onCancel((()=>{n({text:null,date:null})}))}))},promptWithSelect(e="",t="",s="fas fa-question",i=[],n=null){return new Promise((a=>{this.$q.dialog({component:Ve,parent:this,header:e,label:t,options:i,current:n,icon:s,cancel:!0,persistent:!0}).onOk((e=>{a(e)})).onCancel((()=>{a(null)}))}))},onRequestDblClick(e){const t=e.target.closest("tr").cells[0].dataset.number;this.activeRequest=this.requests.find((e=>+e.number===+t)),this.doOpen()},newRequest(){this.activeRequest={number:0},this.doOpen()},messageSettings(){}}},et=Ze,tt=(s("15f8"),s("4d5a")),st=s("9404"),it=s("09e3"),nt=s("9989"),at=s("8562"),lt=s("58a81"),ot=s("6b1d"),rt=s("4e73"),ct=s("a12b"),dt=s("714f"),ut=Object(c["a"])(et,i,n,!1,null,null,null);t["default"]=ut.exports;b()(ut,"components",{QLayout:tt["a"],QDrawer:st["a"],QBtn:m["a"],QList:ye["a"],QItem:O["a"],QItemSection:E["a"],QIcon:v["a"],QPageContainer:it["a"],QPage:nt["a"],QSplitter:at["a"],QTabs:qe["a"],QTab:ge["a"],QBadge:lt["a"],QTable:se["a"],QTd:ie["a"],QTooltip:le["a"],QLinearProgress:ot["a"],QMenu:rt["a"],QVirtualScroll:ct["a"],QDialog:Q["a"]}),b()(ut,"directives",{Ripple:dt["a"]})}}]);